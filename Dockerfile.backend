FROM golang:1.25-alpine AS builder
WORKDIR /app/backend
COPY backend/go.mod backend/go.sum ./
RUN go mod download
COPY backend/ .
ARG TARGETOS
ARG TARGETARCH
RUN CGO_ENABLED=0 GOOS=${TARGETOS:-linux} GOARCH=${TARGETARCH:-amd64} go build -o anakosmos-server main.go

FROM scratch
COPY --from=builder /app/backend/anakosmos-server /anakosmos-server
